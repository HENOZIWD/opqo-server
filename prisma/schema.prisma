generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @unique
  refreshToken  String
  email         String         @unique
  name          String         @db.VarChar(50)
  description   String         @default("") @db.VarChar(1000)
  createdDate   DateTime       @default(now())
  picture       String
  comments      Comment[]      @relation("UserComments")
  LiveStreaming LiveStreaming?
  StreamKey     StreamKey?
  videos        Video[]        @relation("UserVideos")
  watchHistory  WatchHistory[] @relation("UserHistories")
}

model Video {
  id              String         @id @unique @default(cuid())
  hash            String
  width           Int
  height          Int
  duration        Float
  extension       String
  size            Int
  userId          String
  totalChunkCount Int
  createdDate     DateTime       @default(now())
  description     String?        @db.VarChar(5000)
  title           String?        @db.VarChar(100)
  isUploaded      Boolean        @default(false)
  comments        Comment[]      @relation("VideoComments")
  user            User           @relation("UserVideos", fields: [userId], references: [id], onDelete: Cascade)
  watchHistory    WatchHistory[] @relation("VideoHistories")
}

model VideoChunk {
  videoId    String
  chunkIndex Int

  @@id([videoId, chunkIndex])
}

model WatchHistory {
  videoId       String
  userId        String
  watchedDate   DateTime @default(now())
  watchProgress Int
  user          User     @relation("UserHistories", fields: [userId], references: [id], onDelete: Cascade)
  video         Video    @relation("VideoHistories", fields: [videoId], references: [id], onDelete: Cascade)

  @@id([videoId, userId])
}

model Comment {
  id          String   @id @unique @default(cuid())
  createdDate DateTime @default(now())
  comment     String   @db.VarChar(5000)
  userId      String
  videoId     String
  user        User     @relation("UserComments", fields: [userId], references: [id], onDelete: Cascade)
  video       Video    @relation("VideoComments", fields: [videoId], references: [id], onDelete: Cascade)
}

model LiveStreaming {
  userId          String   @id @unique
  isStreaming     Boolean
  streamStartDate DateTime
  title           String   @db.VarChar(100)
  User            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model StreamKey {
  userId String @id @unique
  value  String
  User   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}
